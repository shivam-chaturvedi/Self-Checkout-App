<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Manage Products</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-200 min-h-screen p-5">

	<!-- Button for adding a product -->
	<div class="flex justify-end mb-4">
		<button id="add-product"
			class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition">
			+ Add Product</button>
	</div>

	<!-- Main Container -->
	<div class="bg-white shadow-lg rounded-lg p-8 w-full max-w-4xl mx-auto">
		<h1 class="text-2xl font-semibold text-gray-800 mb-6">Products</h1>

		<!-- Add Product Form Section (centered and with drop shadow) -->
		<div id="addProductForm"
			class="hidden fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50 z-50">
			<div
				class="max-w-lg w-full p-6 bg-white shadow-2xl rounded-lg relative">
				<h2 class="text-xl font-semibold mb-6 text-center">Add Your
					Products Here</h2>

				<!-- Form for adding products -->
				<form method="post" action="/product/add" class="space-y-4">
					<input type="hidden" th:name="${_csrf.parameterName}"
						th:value="${_csrf.token}" /> <input type="text" name="name"
						placeholder="Enter Product Name..." required
						class="w-full p-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500" />
					<input type="number" name="price" placeholder="Enter Price (in ₹)"
						required min="1" step="any"
						class="w-full p-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-500" />
					<button type="submit"
						class="w-full bg-green-500 hover:bg-green-600 text-white py-3 rounded transition">
						Add Product</button>
				</form>

				<!-- Cancel button to close the form -->
				<button id="cancelButton"
					class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
					<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="20"
						height="20" viewBox="0 0 50 50">
<path
							d="M 25 2 C 12.309534 2 2 12.309534 2 25 C 2 37.690466 12.309534 48 25 48 C 37.690466 48 48 37.690466 48 25 C 48 12.309534 37.690466 2 25 2 z M 25 4 C 36.609534 4 46 13.390466 46 25 C 46 36.609534 36.609534 46 25 46 C 13.390466 46 4 36.609534 4 25 C 4 13.390466 13.390466 4 25 4 z M 32.990234 15.986328 A 1.0001 1.0001 0 0 0 32.292969 16.292969 L 25 23.585938 L 17.707031 16.292969 A 1.0001 1.0001 0 0 0 16.990234 15.990234 A 1.0001 1.0001 0 0 0 16.292969 17.707031 L 23.585938 25 L 16.292969 32.292969 A 1.0001 1.0001 0 1 0 17.707031 33.707031 L 25 26.414062 L 32.292969 33.707031 A 1.0001 1.0001 0 1 0 33.707031 32.292969 L 26.414062 25 L 33.707031 17.707031 A 1.0001 1.0001 0 0 0 32.990234 15.986328 z"></path>
</svg>
				</button>

				<!-- Bulk Upload Form -->
				<div class="mt-8 text-center">
					<p class="font-semibold mb-2">Or Bulk Upload Products</p>
					<form method="post" action="/product/upload"
						enctype="multipart/form-data" class="space-y-4">
						<input type="hidden" th:name="${_csrf.parameterName}"
							th:value="${_csrf.token}" /> <input type="file" name="products"
							accept=".csv" required
							class="w-full p-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />
						<button type="submit"
							class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded transition">
							Upload CSV</button>
					</form>
				</div>
			</div>
		</div>

		<!-- Products Table -->
		<div class="overflow-x-auto mt-8">
			<table
				class="min-w-full bg-white border border-gray-200 text-left text-sm">
				<thead
					class="bg-gray-100 text-gray-600 font-semibold uppercase text-xs">
					<tr>
						<th class="px-4 py-3 border-b border-gray-200">Created At</th>
						<th class="px-4 py-3 border-b border-gray-200">Updated At</th>
						<th class="px-4 py-3 border-b border-gray-200">ID</th>
						<th class="px-4 py-3 border-b border-gray-200">Name</th>
						<th class="px-4 py-3 border-b border-gray-200">Price</th>
						<th class="px-4 py-3 border-b border-gray-200">QR Code</th>
						<th class="px-4 py-3 border-b border-gray-200">Remove</th>
					</tr>
				</thead>
				<tbody id="table" class="text-gray-700">
					<!-- Rows will be dynamically added here -->
				</tbody>
			</table>
		</div>
	</div>

	<script>
        const table = document.getElementById("table");
        const productForm = document.getElementById("addProductForm");
        const addProductButton = document.getElementById("add-product");
        const cancelButton = document.getElementById("cancelButton");

        addProductButton.addEventListener('click', () => {
            productForm.classList.remove('hidden');
        });

        cancelButton.addEventListener('click', () => {
            productForm.classList.add('hidden');
        });

        document.addEventListener("DOMContentLoaded", async () => {
            try {
                const res = await fetch('http://localhost:8080/product/get-all');
                const data = await res.json();

                if (res.ok) {
                    data.forEach((product) => {
                        const row = table.insertRow();
                        row.insertCell(0).textContent = product['createdAt'];
                        row.insertCell(1).textContent = product['updatedAt'];
                        row.insertCell(2).textContent = product['id'];
                        row.insertCell(3).textContent = product['name'];
                        row.insertCell(4).textContent = `₹${product['price']}`;

                        // QR Code cell with SVG icon and download link
                        const qrCell = row.insertCell(5);
                        qrCell.className = "px-4 py-2";
                        qrCell.innerHTML = `
                            <a href="product/qr/${product['id']}" class="text-blue-500 hover:text-blue-700" target="_blank">
                                <svg class="w-6 h-6 inline-block" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                    <path d="M4 4h4v4H4V4zm6 0h4v4h-4V4zm0 6h4v4h-4v-4zM4 10h4v4H4v-4zm6 6h4v4h-4v-4zM4 16h4v4H4v-4zm10-6h6v6h-2v-4h-4v-2zm6-6v4h-2V4h-4V2h6v2zm-6 6v2h-2v-2h2z"/>
                                </svg> QR Code
                            </a>`;

                        // Remove cell with SVG delete icon
                        const deleteCell = row.insertCell(6);
                        deleteCell.className = "px-4 py-2 text-center";
                        deleteCell.innerHTML = `
                            <button class="text-red-500 hover:text-red-700">
                                <svg class="w-6 h-6" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                    <path d="M6 7h12v14H6V7zm3 9h2v-6H9v6zm4-6v6h2v-6h-2zm5.5-8L18 4H6L4.5 5H2v2h20V5h-2.5z"/>
                                </svg>
                            </button>`;
                    });
                }
            } catch (e) {
                console.error(e);
            }
        });
    </script>

</body>
</html>
